generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Note: Language codes are validated at the application layer using @sbl/shared/Language.ts
// This allows a single source of truth for language definitions

model Situation {
  identifier String  @id  // Human-readable identifier serves as primary key (e.g., "greeting-basic")
  descriptions Json
  imageLink String?
  targetLanguage String  // Validated against LANGUAGES in @sbl/shared - the language being learned
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  challengesOfExpression       Gloss[] @relation("ExpressionChallenges")
  challengesOfUnderstandingText Gloss[] @relation("UnderstandingChallenges")
}

model Gloss {
  id             String   @id @default(cuid())
  language       String   // Validated against LANGUAGES in @sbl/shared
  content        String
  isParaphrased  Boolean  @default(false)
  transcriptions String[] @default([])
  notes          Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  contains    Gloss[] @relation("GlossContains")
  containedBy Gloss[] @relation("GlossContains")

  nearSynonyms    Gloss[] @relation("GlossNearSynonyms")
  synonymousWith  Gloss[] @relation("GlossNearSynonyms")

  nearHomophones Gloss[] @relation("GlossNearHomophones")
  homophoneOf    Gloss[] @relation("GlossNearHomophones")

  translations Gloss[] @relation("GlossTranslations")
  translatedBy Gloss[] @relation("GlossTranslations")

  clarifiesUsage        Gloss[] @relation("GlossClarifiesUsage")
  clarifiedBy           Gloss[] @relation("GlossClarifiesUsage")
  toBeDifferentiatedFrom Gloss[] @relation("GlossDifferentiations")
  differentiationOf      Gloss[] @relation("GlossDifferentiations")

  expressionSituations      Situation[] @relation("ExpressionChallenges")
  understandingSituations   Situation[] @relation("UnderstandingChallenges")

  @@unique([language, content])
}
