generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Note: Language codes are validated at the application layer using @sbl/shared/Language.ts
// This allows a single source of truth for language definitions

model Situation {
  identifier String  @id  // Human-readable identifier serves as primary key (e.g., "greeting-basic")
  descriptions Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  challengesOfExpression    ChallengeOfExpression[]
  challengesOfUnderstanding ChallengeOfUnderstandingText[]
}

model Gloss {
  id             String   @id @default(cuid())
  language       String   // Validated against LANGUAGES in @sbl/shared
  content        String
  isParaphrased  Boolean  @default(false)
  transcriptions String[] @default([])
  notes          Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  contains    Gloss[] @relation("GlossContains")
  containedBy Gloss[] @relation("GlossContains")

  nearSynonyms    Gloss[] @relation("GlossNearSynonyms")
  synonymousWith  Gloss[] @relation("GlossNearSynonyms")

  nearHomophones Gloss[] @relation("GlossNearHomophones")
  homophoneOf    Gloss[] @relation("GlossNearHomophones")

  translations Gloss[] @relation("GlossTranslations")
  translatedBy Gloss[] @relation("GlossTranslations")

  expressionChallenges    ChallengeOfExpression[]      @relation("ExpressionGlosses")
  understandingChallenges ChallengeOfUnderstandingText[] @relation("UnderstandingGlosses")

  @@unique([language, content])
}

model ChallengeOfExpression {
  id          String   @id @default(cuid())
  prompt      String
  situationId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  situation Situation @relation(fields: [situationId], references: [identifier], onDelete: Cascade)
  glosses   Gloss[]   @relation("ExpressionGlosses")
}

model ChallengeOfUnderstandingText {
  id          String   @id @default(cuid())
  text        String
  language    String   // Validated against LANGUAGES in @sbl/shared
  situationId String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  situation Situation @relation(fields: [situationId], references: [identifier], onDelete: Cascade)
  glosses   Gloss[]   @relation("UnderstandingGlosses")
}
